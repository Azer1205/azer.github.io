import{d as X,g as H,o as d,c as i,a as h,F as S,b as I,n as R,t as L,u as U,j as ge,e as Y,p as ee,k as ae,_ as A,i as me,r,f as ke,w as we,l as T}from"./index-HxRPOjLU.js";const te=["","A","2","3","4","5","6","7","8","9","10","J","Q","K"],xe={black:"#303133",red:"#f56c6c"},ye=["spades","heart","club","diamond"],Z={spades:"♠",heart:"♥",club:"♣",diamond:"♦"},Me={spades:"black",heart:"red",club:"black",diamond:"red"},Ce=(f=0)=>{const w=te.length,u=[];return ye.forEach(g=>{for(let o=1;o<w;o++)u.push({index:o,type:g,color:Me[g],state:f})}),u},be=f=>(ee("data-v-6b6af7ec"),f=f(),ae(),f),Se={class:"poker-card__front"},Ie={class:"poker-card__value"},He={class:"type"},Ve={key:0,class:"poker-card__type"},$e={key:1,class:"poker-card__type"},ze=be(()=>h("div",{class:"poker-card__back"},null,-1)),Oe=X({__name:"index",props:{card:{},width:{default:120},height:{default:180},shadow:{type:Boolean,default:!0}},setup(f){const w=f,u=H(()=>w.card.state===1),g=H(()=>{const{card:{color:C},width:p,height:m}=w;return{"--width":p+"px","--height":m+"px","--color":xe[C]}}),o=H(()=>w.card.type||"spades"),y=H(()=>{const C=w.card.index;return te[C]||"A"});return(C,p)=>(d(),i("div",{class:R(["poker-card",{"is-active":u.value,shadow:C.shadow}]),style:Y(g.value)},[h("div",Se,[(d(),i(S,null,I(2,m=>h("div",{class:R(["poker-card__harf",`poker-card__${y.value}`])},[h("div",Ie,[h("span",He,L(U(Z)[o.value]),1),ge(L(y.value),1)]),C.card.index<11?(d(),i("div",Ve,L(U(Z)[o.value]),1)):(d(),i("div",$e,L(y.value),1))],2)),64))]),ze],6))}}),Le=A(Oe,[["__scopeId","data-v-6b6af7ec"]]),Te=X({__name:"index",props:{width:{default:100},height:{default:150},data:{},shadow:{type:Boolean,default:!0}},setup(f){const w=u=>{const{top:g,left:o,z:y}=u;return{"--top":g+"px","--left":o+"px","z-index":y}};return(u,g)=>(d(),i("div",{class:"poker-card__wrap",style:Y(w(u.data))},[me(Le,{card:u.data.card,width:u.width,height:u.height,shadow:u.shadow},null,8,["card","width","height","shadow"])],4))}}),D=A(Te,[["__scopeId","data-v-6b456ca5"]]),De=f=>(ee("data-v-6331a77d"),f=f(),ae(),f),Ne={class:"game poker"},Be={class:"game-view__desktop"},Ee={class:"game-view__line"},Je={class:"game-view__footer"},We={class:"slots"},Fe={class:"slot"},Pe=De(()=>h("div",{class:"hand"},null,-1)),Re={class:"game-view__slots"},Xe={class:"game-view__handout"},Ye={class:"game-view__hand"},Ae=X({__name:"index",setup(f){const w=r(),u=r(980),g=r(800),o=r(36),y=r(160),C=H(()=>({"--width":u.value+"px","--height":g.value+"px","--padding":o.value+"px","--cardWidth":p.value+"px","--cardHeight":m.value+"px"})),p=r(100),m=r(150),V=r(32),le=r(16),N=H(()=>p.value+le.value),M=r([]),_=r([]),v=r([]),x=r([]),j=()=>{G();const e=Ce();for(let t=0;t<7;t++){for(!v.value[t]&&(v.value[t]=[]);v.value[t].length<t+1;){const a=Math.round(Math.random()*(e.length-1)),l=v.value[t].length;v.value[t].push({z:l,top:l*V.value+o.value,left:t*N.value+y.value,card:e.splice(a,1)[0],line:t})}v.value[t][t].card.state=1}M.value=e.map((t,a)=>({top:g.value-m.value-o.value/2,left:u.value-p.value-o.value,card:t,z:e.length-a,line:-1})),_e()};ke(j);const se=()=>{G(),v.value=F.value.desktop||[],M.value=F.value.hand||[]},G=()=>{M.value=[],_.value=[],v.value=[],x.value=[[],[],[],[]]},B=r(!1),E=r(!1),oe=e=>{if(!e)return;const{top:t,left:a,line:l,card:n}=e,s=(a-y.value)/N.value;let c=Math.floor(s);s-c>2/3&&c++;let b=v.value[c];if(!b){J();return}const O=b.length*V.value+m.value,$=t>O,z=c===l,P=b[b.length-1],fe=P&&(P.card.index!==n.index+1||P.card.color===n.color);if($||z||fe){J();return}de(l,c)},ne=(e,t)=>{const a=x.value.findIndex(l=>l.length&&l[0].card.type===t);if(a!==-1){const l=x.value[a];return l[l.length-1].card.index===e-1?a:-1}return e!==1?-1:x.value.findIndex(l=>!l.length)},ce=(e,t)=>{var a;if((a=k.value)!=null&&a.length){const l=u.value-p.value,{x:n,y:s}=W.value;k.value.forEach((c,b)=>{const O=g.value-m.value-(k.value.length-1-b)*V.value,$=t-s+b*V.value,z=e-n;c.top=$<0?0:$>O?O:$,c.left=z<0?0:z>l?l:z,c.z=100+b})}},J=()=>{k.value.forEach(e=>{e.prev_left&&(e.left=e.prev_left),e.prev_top&&(e.top=e.prev_top)}),k.value=[]},de=(e,t)=>{var n;if(B.value){const s=x.value[e];x.value[e]=s.splice(0,s.length-k.value.length)}else if(E.value)_.value.pop(),K();else{const s=v.value[e];v.value[e]=s.splice(0,s.length-k.value.length)}let a=v.value[t];a=[...a,...k.value],v.value[t]=a.map((s,c)=>(s={...s,z:c,top:c*V.value+o.value,left:t*N.value+y.value,line:t},s));const l=(n=v.value[e])==null?void 0:n.length;l&&(v.value[e][l-1].card.state=1)},ue=(e,t,a)=>{if(a!==e.length-1)return;const{card:{type:l,index:n}}=t,s=ne(n,l);s!==-1&&(t.top=g.value-m.value-o.value/2,t.left=s*(p.value+o.value/2)+o.value,t.z=x.value[s].length+1,t.line=s,e.pop(),x.value[s].push(t),e[e.length-1].card.state=1)},K=()=>{const e=_.value.length,t=u.value-o.value*3-p.value;_.value.forEach((a,l)=>{a.z=l,a.card.state=1,l<e-3?a.left=t-180:a.left=t-(e-l)*60})},k=r([]),W=r({x:0,y:0}),Q=(e,t,a,l,n)=>{const{card:{state:s}}=a;s&&(B.value=n,k.value=t.slice(l),k.value.forEach(c=>{c.prev_top=c.top,c.prev_left=c.left}),console.log(e.clientX,e.clientY),W.value={x:e.clientX-a.left,y:e.clientY-a.top})},re=()=>{oe(k.value[0]),k.value=[],B.value=!1,E.value=!1},ve=e=>{ce(e.clientX,e.clientY)},ie=()=>{J()},q=(e,t,a)=>{ue(e,t,a)},he=()=>{if(M.value.length){const e=M.value.splice(0,3);_.value=[..._.value,...e],K()}else{const e=_.value.length;M.value=_.value.map((t,a)=>(t.card.state=0,{...t,top:g.value-o.value/2-m.value,left:u.value-o.value-p.value,z:e-a})),_.value=[]}},pe=(e,t)=>{if(t<_.value.length-1)return;E.value=!0;const a=_.value[t];a.prev_top=a.top,a.prev_left=a.left,k.value=[a],W.value={x:e.clientX-a.left,y:e.clientY-a.top}},F=r({}),_e=()=>{F.value={desktop:JSON.parse(JSON.stringify(v.value)),hand:JSON.parse(JSON.stringify(M.value))}};return(e,t)=>(d(),i("div",Ne,[h("div",{ref_key:"gameView",ref:w,class:"game-view",style:Y(C.value),onMousemove:ve,onMouseup:re,onMouseleave:ie},[h("div",{class:"game-view__nav"},[h("div",{class:"button",onClick:j},"新游戏"),h("div",{class:"button",onClick:se},"重置")]),h("div",Be,[(d(!0),i(S,null,I(v.value,(a,l)=>(d(),i("div",Ee,[(d(!0),i(S,null,I(a,(n,s)=>(d(),T(D,{data:n,width:p.value,height:m.value,onMousedown:c=>Q(c,a,n,s,!1),onDblclick:c=>q(a,n,s)},null,8,["data","width","height","onMousedown","onDblclick"]))),256))]))),256))]),h("div",Je,[h("div",We,[(d(!0),i(S,null,I(x.value,a=>(d(),i("div",Fe))),256))]),Pe]),(d(!0),i(S,null,I(x.value,a=>(d(),i("div",Re,[(d(!0),i(S,null,I(a,(l,n)=>(d(),T(D,{data:l,width:p.value,height:m.value,shadow:!1,onMousedown:s=>Q(s,a,l,n,!1)},null,8,["data","width","height","onMousedown"]))),256))]))),256)),h("div",Xe,[(d(!0),i(S,null,I(_.value,(a,l)=>(d(),T(D,{data:a,width:p.value,height:m.value,shadow:l>_.value.length-3,onMousedown:n=>pe(n,l),onDblclick:n=>q(_.value,a,l)},null,8,["data","width","height","shadow","onMousedown","onDblclick"]))),256))]),h("div",Ye,[h("div",{class:R(["game-view__cover",{"is-empty":!M.value.length}]),onMousedown:we(he,["stop"])},null,34),(d(!0),i(S,null,I(M.value,(a,l)=>(d(),T(D,{data:a,width:p.value,height:m.value},null,8,["data","width","height"]))),256))])],36)]))}}),Ge=A(Ae,[["__scopeId","data-v-6331a77d"]]);export{Ge as default};
