import{B as Y}from"./board-cTWbpd4b.js";import{p as I}from"./tools-DJurenHp.js";import{d as L,r as c,f as G,g as x,h as O,o as F,c as R,a as _,t as j,i as q,u as P,_ as z}from"./index-HxRPOjLU.js";const J={class:"game"},K={class:"score"},Q={class:"operate"},U=L({__name:"normal",setup(W){const f=c(4),m=c(4),a=c([]),k=c([]),d=c(0),b=c([]),E=()=>{a.value=[],y.value=!1,h.value=!1,w.value=!1,p(!0),setTimeout(()=>{p(!0)},100)};G(E);const $=x(()=>{const o=[];for(let s=0;s<f.value;s++)for(let t=0;t<m.value;t++)o.push(`${s}_${t}`);return o}),D=x(()=>a.value.map(s=>`${s.y}_${s.x}`)),g=x(()=>$.value.filter(o=>!D.value.includes(o))),p=(o=!1)=>{if(!o&&!w.value){g.value.length||(y.value=V(),y.value&&I());return}const s=Date.now().toString(16),t=Math.ceil(Math.random()*21),e=t<1?8:t<5?4:2,l=Math.ceil(Math.random()*(g.value.length-1)),[u,v]=g.value[l].split("_"),n=c({id:s,num:e,x:Number(v),y:Number(u),locked:!1});a.value.push(n.value)},C=()=>{a.value.forEach(o=>o.locked=!1),h.value=!1},i=()=>{w.value=!0;const o=a.value.map(s=>({...s}));k.value.push(o)},H=()=>{const o=k.value.pop(),s=b.value.pop();!o||!s||(a.value=o.map(t=>({...t})),d.value=s)},S=o=>{o&&(d.value+=o,b.value.push(d.value))},h=c(!1),w=c(!1),y=c(!1),V=()=>{const o=a.value.length;for(let s=0;s<o;s++){const{x:t,y:e,num:l}=a.value[s];if([[t-1,e],[t+1,e],[t,e-1],[t,e+1]].map(([n,r])=>a.value.find(T=>T.x===n&&T.y===r)).filter(n=>!!n).map(n=>n==null?void 0:n.num).includes(l))return!1}return!0},A=E,B=o=>{X(o.key)};G(()=>{window.addEventListener("keydown",B)}),O(()=>{window.removeEventListener("keydown",B)});const X=o=>{if(y.value||h.value)return;h.value=!0,w.value=!1;const s={ArrowUp:M,ArrowRight:N,ArrowDown:M,ArrowLeft:N}[o];s&&s(["ArrowUp","ArrowLeft"].includes(o))},M=o=>{const s=[];a.value.forEach(t=>{const{x:e}=t;s[e]||(s[e]=[]),s[e].push(t)}),s.forEach(t=>{t.sort((e,l)=>o?e.y-l.y:l.y-e.y),t.forEach((e,l)=>{const{y:u,num:v}=e;if(o?u>0:u<m.value-1)if(l===0){const n=o?0:m.value-1;u!==n&&(i(),e.y=n)}else{const n=t[l-1];if(n.num===v&&!n.locked)i(),e.y=n.y,e.locked=!0,setTimeout(()=>{e.num*=2,S(e.num),a.value=a.value.filter(r=>r.id!==n.id)},200);else{const r=o?n.y+1:n.y-1;u!==r&&(i(),e.y=r)}}})}),setTimeout(()=>{C(),p()},300)},N=o=>{const s=[];a.value.forEach(t=>{const{y:e}=t;s[e]||(s[e]=[]),s[e].push(t)}),s.forEach(t=>{t.sort((e,l)=>o?e.x-l.x:l.x-e.x),t.forEach((e,l)=>{const{x:u,num:v}=e;if(o?u>0:u<f.value-1)if(l===0){const n=o?0:f.value-1;u!==n&&(i(),e.x=n)}else{const n=t[l-1];if(n.num===v&&!n.locked)i(),e.x=n.x,e.locked=!0,setTimeout(()=>{e.num*=2,S(e.num),a.value=a.value.filter(r=>r.id!==n.id)},200);else{const r=o?n.x+1:n.x-1;u!==r&&(i(),e.x=r)}}})}),setTimeout(()=>{C(),p()},300)};return(o,s)=>(F(),R("div",J,[_("div",K,"分数："+j(d.value),1),q(Y,{cards:a.value,rows:f.value,cols:m.value},null,8,["cards","rows","cols"]),_("div",Q,[_("button",{class:"button",onClick:s[0]||(s[0]=(...t)=>P(A)&&P(A)(...t))},"重置"),_("button",{class:"button",onClick:H},"后退")])]))}}),se=z(U,[["__scopeId","data-v-12de9734"]]);export{se as default};
