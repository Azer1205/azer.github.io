import{B as y}from"./board-cTWbpd4b.js";import{d as M,r,g as R,f as S,o as V,c as G,a as H,t as I,i as g,_ as O}from"./index-HxRPOjLU.js";const P={class:"game"},j={class:"score"},q=M({__name:"drop",setup(z){const m=r(6),x=r(5);let l=[2,4,8,16,32];const f=[8,5,3,2,1],C=R(()=>f.reduce((e,t)=>e+=t)),n=r([]),d=r({num:0,x:0,y:0}),v=r(0);S(()=>{h()});const i=r(!1),k=()=>{let e=Math.random()*C.value,t=0;for(;e>0;)e-=f[t],t++;return l[t-1]},h=()=>{const e=Date.now().toString(16),t=k();d.value={id:e,num:t,x:0,y:0}},D=()=>{i.value||(i.value=!0,p())},E=()=>{n.value=n.value.filter(e=>!e.isDiscard)},p=()=>{const e=[];n.value.forEach(a=>{const{x:o}=a;e[o]||(e[o]=[]),e[o].push(a)}),e.forEach((a,o)=>{a.sort((s,c)=>s.y-c.y),a.forEach((s,c)=>{s.y!==c?(s.y=c,s.needCheck=!0):s.needCheck=!1})});const t=n.value.filter(a=>a.needCheck);if(!t.length){i.value=!1;return}setTimeout(()=>{N(t)},300)},N=e=>{e.forEach(t=>{let a=0;const{x:o,y:s,num:c}=t;[[o-1,s],[o+1,s],[o,s-1],[o,s+1]].forEach(([b,T])=>{const u=n.value.find(_=>_.x===b&&_.y===T);u&&u.num===c&&(a++,u.x=o,u.y=s,u.isDiscard=!0)}),setTimeout(()=>{t.num*=Math.pow(2,a),v.value+=c,E(),p()},50)})},w=()=>{const e=l[0],t=l[l.length-1];let a=!1,o=!1;n.value.forEach(s=>{s.num===e&&(a=!0),s.num>=t*4&&(o=!0)}),o&&!a&&(l=l.map(s=>s*2)),h()},B=({x:e})=>{if(i.value)return;const t=r({...d.value,x:e,y:m.value});n.value.push(t.value),setTimeout(w,200),setTimeout(D,300)};return(e,t)=>(V(),G("div",P,[H("div",j,"分数："+I(v.value),1),g(y,{cards:n.value,rows:m.value,cols:x.value,onDrop:B},null,8,["cards","rows","cols"]),g(y,{style:{"margin-top":"24px"},cards:[d.value],rows:1,cols:1},null,8,["cards"])]))}}),K=O(q,[["__scopeId","data-v-7cea263b"]]);export{K as default};
