var G=Object.defineProperty,H=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var C=(r,a,c)=>a in r?G(r,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[a]=c,k=(r,a)=>{for(var c in a||(a={}))O.call(a,c)&&C(r,c,a[c]);if(x)for(var c of x(a))P.call(a,c)&&C(r,c,a[c]);return r},D=(r,a)=>H(r,I(a));import{B as E}from"./board-BM61UKu_.js";import{d as q,r as i,h as z,g as A,o as F,c as J,a as K,t as L,j as N,_ as Q}from"./index-CiY8X3GU.js";const U={class:"game"},W={class:"score"},X=q({__name:"drop",setup(r){const a=i(6),c=i(5);let d=[2,4,8,16,32];const h=[8,5,3,2,1],w=z(()=>h.reduce((e,t)=>e+=t)),l=i([]),v=i({num:0,x:0,y:0}),p=i(0);A(()=>{_()});const f=i(!1),B=()=>{let e=Math.random()*w.value,t=0;for(;e>0;)e-=h[t],t++;return d[t-1]},_=()=>{const e=Date.now().toString(16),t=B();v.value={id:e,num:t,x:0,y:0}},b=()=>{f.value||(f.value=!0,y())},T=()=>{l.value=l.value.filter(e=>!e.isDiscard)},y=()=>{const e=[];l.value.forEach(o=>{const{x:n}=o;e[n]||(e[n]=[]),e[n].push(o)}),e.forEach((o,n)=>{o.sort((s,u)=>s.y-u.y),o.forEach((s,u)=>{s.y!==u?(s.y=u,s.needCheck=!0):s.needCheck=!1})});const t=l.value.filter(o=>o.needCheck);if(!t.length){f.value=!1;return}setTimeout(()=>{M(t)},300)},M=e=>{e.forEach(t=>{let o=0;const{x:n,y:s,num:u}=t;[[n-1,s],[n+1,s],[n,s-1],[n,s+1]].forEach(([V,j])=>{const m=l.value.find(g=>g.x===V&&g.y===j);m&&m.num===u&&(o++,m.x=n,m.y=s,m.isDiscard=!0)}),setTimeout(()=>{t.num*=Math.pow(2,o),p.value+=u,T(),y()},50)})},R=()=>{const e=d[0],t=d[d.length-1];let o=!1,n=!1;l.value.forEach(s=>{s.num===e&&(o=!0),s.num>=t*4&&(n=!0)}),n&&!o&&(d=d.map(s=>s*2)),_()},S=({x:e})=>{if(f.value)return;const t=i(D(k({},v.value),{x:e,y:a.value}));l.value.push(t.value),setTimeout(R,200),setTimeout(b,300)};return(e,t)=>(F(),J("div",U,[K("div",W,"分数："+L(p.value),1),N(E,{cards:l.value,rows:a.value,cols:c.value,onDrop:S},null,8,["cards","rows","cols"]),N(E,{style:{"margin-top":"24px"},cards:[v.value],rows:1,cols:1},null,8,["cards"])]))}}),te=Q(X,[["__scopeId","data-v-7cea263b"]]);export{te as default};
