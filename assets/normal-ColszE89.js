var R=Object.defineProperty;var P=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var V=(f,l,r)=>l in f?R(f,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[l]=r,g=(f,l)=>{for(var r in l||(l={}))q.call(l,r)&&V(f,r,l[r]);if(P)for(var r of P(l))J.call(l,r)&&V(f,r,l[r]);return f};import{B as $}from"./Button-Btf5IT0s.js";import{B as K}from"./board-cUXRfnSF.js";import{p as Q}from"./tools-DJurenHp.js";import{d as U,j as v,c as k,h as D,i as W,o as Z,a as ee,f as H,t as se,m as C,w as X,u as te,k as Y,_ as oe}from"./index-C2FjaYkJ.js";const ae={class:"game"},ne={class:"score"},le={class:"operate"},re=U({__name:"normal",setup(f){const l=v(4),r=v(4),n=v([]),z=k(()=>{const s=[];for(let t=0;t<l.value;t++)for(let a=0;a<r.value;a++)s.push(`${t}_${a}`);return s}),I=k(()=>n.value.map(t=>`${t.y}_${t.x}`)),x=k(()=>z.value.filter(s=>!I.value.includes(s))),p=v(0),h=(s=!1)=>{if(!s&&!y.value){x.value.length||(_.value=L(),_.value&&Q());return}const t=Date.now().toString(16),a=Math.ceil(Math.random()*21),e=a<1?8:a<5?4:2,u=Math.ceil(Math.random()*(x.value.length-1)),[c,d]=x.value[u].split("_"),o=v({id:t,num:e,x:Number(d),y:Number(c),locked:!1});n.value.push(o.value)},E=()=>{n.value.forEach(s=>s.locked=!1),w.value=!1},m=()=>{y.value=!0;const s=n.value.map(t=>g({},t));M.value.push(s)},b=s=>{s&&(p.value+=s,T.value.push(p.value))},B=()=>{n.value=[],p.value=0,_.value=!1,w.value=!1,y.value=!1,h(!0),setTimeout(()=>{h(!0)},100)};D(B);const w=v(!1),y=v(!1),_=v(!1),L=()=>{const s=n.value.length;for(let t=0;t<s;t++){const{x:a,y:e,num:u}=n.value[t];if([[a-1,e],[a+1,e],[a,e-1],[a,e+1]].map(([o,i])=>n.value.find(G=>G.x===o&&G.y===i)).filter(o=>!!o).map(o=>o==null?void 0:o.num).includes(u))return!1}return!0},S=s=>{F(s.key)};D(()=>{window.addEventListener("keydown",S)}),W(()=>{window.removeEventListener("keydown",S)});const O=B,j=()=>{const s=M.value.pop(),t=T.value.pop();!s||!t||(n.value=s.map(a=>g({},a)),p.value=t)},F=s=>{if(_.value||w.value)return;w.value=!0,y.value=!1;const t={ArrowUp:A,ArrowRight:N,ArrowDown:A,ArrowLeft:N}[s];t&&t(["ArrowUp","ArrowLeft"].includes(s))},A=s=>{const t=[];n.value.forEach(a=>{const{x:e}=a;t[e]||(t[e]=[]),t[e].push(a)}),t.forEach(a=>{a.sort((e,u)=>s?e.y-u.y:u.y-e.y),a.forEach((e,u)=>{const{y:c,num:d}=e;if(s?c>0:c<r.value-1)if(u===0){const o=s?0:r.value-1;c!==o&&(m(),e.y=o)}else{const o=a[u-1];if(o.num===d&&!o.locked)m(),e.y=o.y,e.locked=!0,setTimeout(()=>{e.num*=2,b(e.num),n.value=n.value.filter(i=>i.id!==o.id)},200);else{const i=s?o.y+1:o.y-1;c!==i&&(m(),e.y=i)}}})}),setTimeout(()=>{E(),h()},300)},N=s=>{const t=[];n.value.forEach(a=>{const{y:e}=a;t[e]||(t[e]=[]),t[e].push(a)}),t.forEach(a=>{a.sort((e,u)=>s?e.x-u.x:u.x-e.x),a.forEach((e,u)=>{const{x:c,num:d}=e;if(s?c>0:c<l.value-1)if(u===0){const o=s?0:l.value-1;c!==o&&(m(),e.x=o)}else{const o=a[u-1];if(o.num===d&&!o.locked)m(),e.x=o.x,e.locked=!0,setTimeout(()=>{e.num*=2,b(e.num),n.value=n.value.filter(i=>i.id!==o.id)},200);else{const i=s?o.x+1:o.x-1;c!==i&&(m(),e.x=i)}}})}),setTimeout(()=>{E(),h()},300)},M=v([]),T=v([]);return(s,t)=>(Z(),ee("div",ae,[H("div",ne,"分数："+se(p.value),1),C(K,{cards:n.value,rows:l.value,cols:r.value},null,8,["cards","rows","cols"]),H("div",le,[C($,{class:"button",type:"warning",size:"small",onClick:te(O)},{default:X(()=>[Y("新游戏")]),_:1},8,["onClick"]),C($,{class:"button",type:"warning",size:"small",onClick:j},{default:X(()=>[Y("后退")]),_:1})])]))}}),me=oe(re,[["__scopeId","data-v-ea2ddf7f"]]);export{me as default};
