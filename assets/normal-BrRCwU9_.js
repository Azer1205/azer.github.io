var j=Object.defineProperty;var $=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var D=(f,l,r)=>l in f?j(f,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[l]=r,k=(f,l)=>{for(var r in l||(l={}))F.call(l,r)&&D(f,r,l[r]);if($)for(var r of $(l))R.call(l,r)&&D(f,r,l[r]);return f};import{B as q}from"./board-BM61UKu_.js";import{p as z}from"./tools-DJurenHp.js";import{d as J,r as v,g as H,h as b,i as K,o as Q,c as U,a as g,t as W,j as Z,f as V,_ as ee}from"./index-CiY8X3GU.js";const oe={class:"game"},se={class:"score"},te={class:"operate"},ne=J({__name:"normal",setup(f){const l=v(4),r=v(4),a=v([]),E=v([]),p=v(0),C=v([]),S=()=>{a.value=[],_.value=!1,w.value=!1,y.value=!1,h(!0),setTimeout(()=>{h(!0)},100)};H(S);const X=b(()=>{const o=[];for(let s=0;s<l.value;s++)for(let t=0;t<r.value;t++)o.push(`${s}_${t}`);return o}),Y=b(()=>a.value.map(s=>`${s.y}_${s.x}`)),x=b(()=>X.value.filter(o=>!Y.value.includes(o))),h=(o=!1)=>{if(!o&&!y.value){x.value.length||(_.value=L(),_.value&&z());return}const s=Date.now().toString(16),t=Math.ceil(Math.random()*21),e=t<1?8:t<5?4:2,u=Math.ceil(Math.random()*(x.value.length-1)),[c,d]=x.value[u].split("_"),n=v({id:s,num:e,x:Number(d),y:Number(c),locked:!1});a.value.push(n.value)},A=()=>{a.value.forEach(o=>o.locked=!1),w.value=!1},m=()=>{y.value=!0;const o=a.value.map(s=>k({},s));E.value.push(o)},I=()=>{const o=E.value.pop(),s=C.value.pop();!o||!s||(a.value=o.map(t=>k({},t)),p.value=s)},B=o=>{o&&(p.value+=o,C.value.push(p.value))},w=v(!1),y=v(!1),_=v(!1),L=()=>{const o=a.value.length;for(let s=0;s<o;s++){const{x:t,y:e,num:u}=a.value[s];if([[t-1,e],[t+1,e],[t,e-1],[t,e+1]].map(([n,i])=>a.value.find(P=>P.x===n&&P.y===i)).filter(n=>!!n).map(n=>n==null?void 0:n.num).includes(u))return!1}return!0},M=S,N=o=>{O(o.key)};H(()=>{window.addEventListener("keydown",N)}),K(()=>{window.removeEventListener("keydown",N)});const O=o=>{if(_.value||w.value)return;w.value=!0,y.value=!1;const s={ArrowUp:T,ArrowRight:G,ArrowDown:T,ArrowLeft:G}[o];s&&s(["ArrowUp","ArrowLeft"].includes(o))},T=o=>{const s=[];a.value.forEach(t=>{const{x:e}=t;s[e]||(s[e]=[]),s[e].push(t)}),s.forEach(t=>{t.sort((e,u)=>o?e.y-u.y:u.y-e.y),t.forEach((e,u)=>{const{y:c,num:d}=e;if(o?c>0:c<r.value-1)if(u===0){const n=o?0:r.value-1;c!==n&&(m(),e.y=n)}else{const n=t[u-1];if(n.num===d&&!n.locked)m(),e.y=n.y,e.locked=!0,setTimeout(()=>{e.num*=2,B(e.num),a.value=a.value.filter(i=>i.id!==n.id)},200);else{const i=o?n.y+1:n.y-1;c!==i&&(m(),e.y=i)}}})}),setTimeout(()=>{A(),h()},300)},G=o=>{const s=[];a.value.forEach(t=>{const{y:e}=t;s[e]||(s[e]=[]),s[e].push(t)}),s.forEach(t=>{t.sort((e,u)=>o?e.x-u.x:u.x-e.x),t.forEach((e,u)=>{const{x:c,num:d}=e;if(o?c>0:c<l.value-1)if(u===0){const n=o?0:l.value-1;c!==n&&(m(),e.x=n)}else{const n=t[u-1];if(n.num===d&&!n.locked)m(),e.x=n.x,e.locked=!0,setTimeout(()=>{e.num*=2,B(e.num),a.value=a.value.filter(i=>i.id!==n.id)},200);else{const i=o?n.x+1:n.x-1;c!==i&&(m(),e.x=i)}}})}),setTimeout(()=>{A(),h()},300)};return(o,s)=>(Q(),U("div",oe,[g("div",se,"分数："+W(p.value),1),Z(q,{cards:a.value,rows:l.value,cols:r.value},null,8,["cards","rows","cols"]),g("div",te,[g("button",{class:"button",onClick:s[0]||(s[0]=(...t)=>V(M)&&V(M)(...t))},"重置"),g("button",{class:"button",onClick:I},"后退")])]))}}),ce=ee(ne,[["__scopeId","data-v-12de9734"]]);export{ce as default};
